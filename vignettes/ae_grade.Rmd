---
title: "Adverse Event (AE)"
output: 
  rmarkdown::html_vignette:
    number_sections: true
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
date: "2025-01-30"

---

<!-- https://oncostat.github.io/grstat/articles/adverse_events_sas.html -->

# Introduction

This vignette demonstrates how to implement adverse event (AE) tables in R using the 'grstat' package. AE tables are a standard approach in clinical research for assessing event severity (grade) and specifying the exact AE terms.

In this article, three types of AE tables are presented:

Maximum AE grade per patient (for both single-arm and two-arm trials)

All AE grades per patient (for both single-arm and two-arm trials)

Maximum AE grade per patient by AE term (for both single-arm and two-arm trials)

The vignette also outlines the steps for calculating treatment-emergent adverse events (TEAEs).

This vignette covers the following steps:

Overview of the dataset, using the simulated dataset grstat_example

Creation of various AE tables for single-arm and two-arm trials, including subgroup analysis based on whether the AE is:

Related to the study drug

Leading to treatment interruption or discontinuation

Requiring dose reduction

Additionally, Adverse Events of Special Interest (AESI) tables will also be demonstrated.

First, install packages if needed and load them.

```{r setup}
library(grstat)
library(flextable)
library(dplyr)
```

# Data Overview

The function grstat_example() is used as an example dataset to illustrate the data usage.

This analysis focuses on two datasets:

- ae, which contains data on adverse events.

- enrolres, which includes all patients and their respective treatment arms."

```{r}
# #| label: "setup"
# #| message: false
# #| warning: false
# library(grstat)
# library(flextable)
# library(dplyr)

tm = grstat_example()
attach(tm)

head(ae)

head(enrolres)

```
# Tables Grade

create table adverse event grades by using  ae_table_grade()

## Table of maximum grades per patient

```{r}
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm=NULL, variant="max") %>% 
  as_flextable(header_show_n=TRUE) %>%
  # comment tu peux changer la size des footnotes?
  add_footer_lines("Percentages reflect the proportion of patients whose maximum AE grade was as indicated.")
```

## Table of maximum grades per patient by arms

```{r}
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm="arm", variant="max") %>% 
  as_flextable(header_show_n=TRUE) %>% 
  add_footer_lines("Percentages reflect the proportion of patients presenting at most one AE of given grade")
```

## Table of all grades per patient 

```{r}
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm=NULL, variant="eq") %>% 
  as_flextable(header_show_n=TRUE) %>% 
  add_footer_lines("Percentages reflect the proportion of patients presenting at least one AE of given grade")
```

## Table of all grades per patient by arms

```{r}
ae_table_grade(df_ae=ae, df_enrol=enrolres, arm="arm", variant="eq") %>% 
  as_flextable(header_show_n=TRUE) %>% 
  add_footer_lines("Percentages reflect the proportion of patients presenting at least one AE of given grade")
```

