---
title: "ORR Guideline Suggestions"
author: "Alexis COCHARD"
output: 
  rmarkdown::html_vignette:
    number_sections: true
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{ORR Guideline Suggestions}
  %\VignetteEncoding{UTF-8}
---

# Introduction

This vignette illustrates the implementation of ORR analysis in R using `grstat` package. In this example, the following response-based endpoints are analysed:

-   Overall Response Rate (ORR), unconfirmed and confirmed: Measured the proportion of patients achieving a complete or partial response to treatment within a specified time frame.A partial response is a decrease in the size of a tumor or in the amount of cancer in the body, and a complete response is the disappearance of all signs of cancer in the body. In a clinical trial, measuring the ORR is one way to see how well a new treatment works.

-   Clinical Benefit Rate (CBR): Proportion of complete response, partial response, and stable disease lasting at least six months (using a window of +/-1 month for the RECIST date) to assess overall treatment benefit.

This vignette covers the following steps:

-   Preparation of the dataset.

-   Use of the `aggregate_recist_rates()` function

-   Creation of a nice looking flextable from the `aggregate_recist_rates()` function

First, install packages if needed and load them.

```{r setup, warning=FALSE, message=FALSE}
## Load libraries
library(grstat)
```

# Data Preparation

## Data Overview

To calculate the ORR, we'll use the "recist" dataset. This dataset must be in long format (one line represents a single measure of a patient's recist criterion) and must contain at least the columns :

-   subjid, Patient ID

-   rcdt, Evaluation date

-   rcresp, Global response

## Display dataset

We use `grstat_example()` to simulate data

```{r}
db = grstat_example(N=200)
recist = db$recist %>%
  select(subjid,rcresp,rcdt) %>%
  filter(subjid<3)

recist
```

# aggregate_recist_rates() function

`aggregate_recist_rates()` consist of 6 paramater :

-   data, the recist data.frame

-   subjid, the column for Patient ID

-   rc_resp, the column for Global response

-   rc_date, the column for Evaluation date

-   confirmed, for a confirmed or unconfirmed response

-   show_cbr, to show the CBR in the results

```{r}
tbl = aggregate_recist_rates(recist, subjid="subjid", rc_resp="rcresp", rc_date="rcdt")
tbl

#If we want an ORR confirmed : 
tbl2 = aggregate_recist_rates(recist, subjid="subjid", rc_resp="rcresp", rc_date="rcdt", confirmed = TRUE)
tbl2

#If we want the CBR :
tbl3 = aggregate_recist_rates(recist, subjid="subjid", rc_resp="rcresp", rc_date="rcdt", confirmed = TRUE, show_CBR = TRUE)
tbl3
```

# Transformation into a flextable

To transfrome our `aggregate_recist_rates` (a data.frame) into a simple flextable, we just have to use the `flextable()` function. But since we wan't a a more specified flextable, we will use the function `as_flextable()` that will take into account the call of our `aggregate_recist_rates()` to create a flextable following a specific model

```{r}
ftbl = tbl %>% as_flextable()
ftbl

#It's also possible with confirmed ORR : 
ftbl2 = tbl2 %>% as_flextable()
ftbl2

#And CBR :
ftbl3 = tbl3 %>% as_flextable()
ftbl3

```

After that, you can add footnote, surround, etc..., like with a classical flextable object
